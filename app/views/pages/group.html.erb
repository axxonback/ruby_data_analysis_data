<% @page_title = "Page Information - Group ##{@group.id}" %>
<%= render(:partial => 'page_breadcrumbs', :locals => {:showgroups=> true, :group => @group}) %>
<header class="jumbotron subhead" id="overview">
  <h1>Page Information for <%= @group.name %></h1>
  <p class="lead">
    Data for <%= year_week_for_last_week%>
    (<%= date_range_for_last_week%>) 
  </p>
</header>

  <div class="page-header">
    <h2>Landing Page</h2>
  </div>  
  <div class="row">
    <div class="span4">
      <%- index_stats = @group.landing_diffs.latest_week.by_metric('views').first -%>
      <p><span class='bignumber'><%=number_with_precision(index_stats.total, :precision => 0)%></span> views for week</p>
      <p><%= pct_change(index_stats.pct_change_week,'mednumber') %> from previous week</p>
      <p><%= pct_change(index_stats.pct_change_year,'mednumber') %> from previous year</p>
      <p><%= trend(index_stats.recent_pct_change,'mednumber') %> trend/week (last <%=Settings.recent_weeks%> weeks)</p>
    </div>
  
    <div class="span8">
      <h3>Views per week over time</h3>
      <%= render(:partial => 'data_plot', :locals => {:data => @group.landing_diffs.by_metric('views').stats_to_graph_data, :datalabel => 'index'})%> 
    </div>
  </div>

<%- Page::DATATYPES.each do |datatype| -%>
  <div class="page-header">
    <h2><%= datatype.pluralize %></h2>
  </div>  
  <div class="row">
    <div class="span4">
      <%- stats_for_week_for_datatype = @group.stats_for_week_for_datatype(datatype) -%>
      <%- if stats_for_week_for_datatype[:pages] and stats_for_week_for_datatype[:pages] > 0 -%>   
        <%= render(:partial => 'overall_views_information', :locals => {:datatype => datatype, :stats_for_week => stats_for_week_for_datatype}) %>
        <p>
          <%= link_to("<i class='icon-th'></i> #{datatype.pluralize} list".html_safe,list_group_pages_path(:datatype => datatype, :group => @group.id),:class => 'btn btn-info') %>      
        </p>
      <%- else -%>
        No data.
      <%- end -%>
    </div>
  
    <%- if stats_for_week_for_datatype[:pages] and stats_for_week_for_datatype[:pages] > 0 -%>   
    <div class="span8">
      <h3>Views per week over time <small><%= link_to('more graphs...',graphs_pages_path(:datatype => datatype,:group => @group.id))%></small></h3>
      <%= render(:partial => 'graphs_plot', :locals => {:data => @group.graph_data_by_datatype(datatype), :datakey => "views", :datalabel => datatype, :ymax => @group.total_diffs.max_views(5)})%>     
    </div>
    <%- end -%>
  </div>
<%- end -%>